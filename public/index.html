<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JoyTan | 做自己，不将就</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="undefined">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="JoyTan">
<meta property="og:url" content="http://joytan1209.github.io/index.html">
<meta property="og:site_name" content="JoyTan">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JoyTan">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="JoyTan" type="application/atom+xml">
  
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="loading" class="active"></div>

  <nav id="menu"  >
   <div class="inner">
  <a href="javascript:;" class="header-icon waves-circle-light" id="menu-off">
      <i class="icon icon-lg icon-close"></i>
  </a>
  <div class="brand-wrap">
    <div class="brand">
      <a href="/" class="avatar"><img src="/img/logo.jpg"></a>
      <hgroup class="introduce">
        <h5 class="nickname">谈朝银</h5>
        <a href="mailto:undefined" title="JoyTan1209@qq.com" class="mail">JoyTan1209@qq.com</a>
      </hgroup>
    </div>
  </div>
  <ul class="nav">
    
        <li class="waves-block active">
          <a href="/"  >
            <i class="icon icon-lg icon-home"></i>
            主页
          </a>
        </li>
    
        <li class="waves-block">
          <a href="/archives"  >
            <i class="icon icon-lg icon-archives"></i>
            归档
          </a>
        </li>
    
        <li class="waves-block">
          <a href="/tags"  >
            <i class="icon icon-lg icon-tags"></i>
            标签
          </a>
        </li>
    
        <li class="waves-block">
          <a href="https://github.com/JoyTan1209" target="_blank" >
            <i class="icon icon-lg icon-github"></i>
            Github
          </a>
        </li>
    
        <li class="waves-block">
          <a href="http://www.weibo.com/JoyTan1209" target="_blank" >
            <i class="icon icon-lg icon-weibo"></i>
            微博
          </a>
        </li>
    
        <li class="waves-block">
          <a href="/about"  >
            <i class="icon icon-lg icon-link"></i>
            关于
          </a>
        </li>
    
  </ul>

  <footer class="footer">
	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  <p>
  <a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>JoyTan &copy; 2016</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>
</footer>
</div>

  </nav>
  <main id="main">
    <header class="header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-circle-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">JoyTan</div>
        
        <a href="javascript:;" class="header-icon waves-circle-light" id="menu-share">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header">
  <div class="container">
    <h1 class="author">JoyTan</h1>
    <h5 class="subtitle">做自己，不将就</h5>
  </div>
</header>

    <div class="container body-wrap">
      
  <ul class="post-list">
  
    <li class="post-list-item">
  <article id="posts-Android APP 自动登录" class="article article-type-posts" itemscope itemprop="blogPost">
    
      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/2016/05/05/Android APP 自动登录/">浅谈Android App 自动登录实现</a>
    </h3>
  



      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动开发/">移动开发</a></li></ul>
</div>
        <time datetime="2016-05-05T06:02:49.000Z" itemprop="datePublished" class="post-tiem">
  2016-05-05
</time>
      </div>
      <div class="post-content" itemprop="postContent" >
        
          <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>自动登录应该是比较常见的需求了，绝大多数的APP都有这个功能。所谓自动登录，就是登录之后，在下次重启App后用户仍然可以登录，而不需要重新输入用户名和密码。因为每次都要用户输入用户名/密码登录是很麻烦的事情，当然强迫症除外。</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><p>最常见的做法就是，登录成功后，将用户名、密码保存到本地。重拾是判断本地是否有已保存的用户名、密码，如果有则以本地保存的用户名、密码做模拟登录操作。</p>
<p>最常用的保存用户名、密码方法就是使用SharedPreferences了。这里就不介绍SharedPreferences了。</p>
<p>但是，这种方法安全吗？答案是当然不安全了，这种保存方式很容易被窃取。所以在保存用户名、密码时需要做加密处理，而且要用非对称加密方式。对称加密方式在源码外泄时，很容易被方向推算出来。见到过团队就是简单加密后保存的，这种做法存在极大的安全隐患。</p>
<p>还有就是，在登录时有验证码的情况。在这种情况下，就需要重构了，上面的提到的登录方式是不能自动提交验证码的。当然，自动提交验证码就失去了验证码的意义了。此种情况下就需要使用cookie了。</p>

        
      </div>
      <div class="post-footer clearfix">
        <a href="/2016/05/05/Android APP 自动登录/" class="post-more waves-button-light">更多</a>
      </div>
    

  </article>


</li>
  
    <li class="post-list-item">
  <article id="posts-阿里Weex跨平台开发工具开源啦" class="article article-type-posts" itemscope itemprop="blogPost">
    
      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/2016/04/22/阿里Weex跨平台开发工具开源啦/">阿里Weex跨平台开发工具开源啦</a>
    </h3>
  



      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/杂谈/">杂谈</a></li></ul>
</div>
        <time datetime="2016-04-22T06:33:53.000Z" itemprop="datePublished" class="post-tiem">
  2016-04-22
</time>
      </div>
      <div class="post-content" itemprop="postContent" >
        
          <h2 id="Weex简介"><a href="#Weex简介" class="headerlink" title="Weex简介"></a>Weex简介</h2><p><img src="../../../../images/weex.png" alt="Weex"><br>Weex能够完美兼顾性能与动态性，让移动开发者通过简捷的前端语法写出Native级别的性能体验，并支持iOS、安卓、YunOS及Web等多端部署。</p>
<p>阿里巴巴与2016年4月21日在Qcon大会上宣布跨平台开发工具Weex开放内测邀请。<br>可以在官网申请：<a href="http://alibaba.github.io/weex/index.html#subscriptionWeex" target="_blank" rel="external">Weex</a>，又一前端开发者的福音！目前内测邀请只有Android版本，据说，在6月份将全部开源:iOS、Android、H5</p>
<h2 id="解决的痛点"><a href="#解决的痛点" class="headerlink" title="解决的痛点"></a>解决的痛点</h2><p>Why?为什么要使用呢</p>
<p>Weex主要解决了两大痛点：频繁发版和多端研发，同时解决了前端语言性能差和显示效果受限的问题。</p>
<p>我们只需要在自己的APP中依赖Weex的SDK，就可以用HTML/CSS/JavaScript来开发Native级别的界面。可以部署在服务端，在APP中执行请求。</p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><p>相比最近比较火的开源跨平台移动开放项目React Native，Weex更加轻量，提交更加小巧。当然，他们各自的实现方式有所不同。Weex基于web conponent标准，使得开发更加简洁标准，方便上手。Native组件和API都可以横向扩展，方便根据业务灵活定制。Weex渲染层具备优异的性能表现，能够跨平台实现一致的布局效果和实现。对于前端开发来说，Weex能够实现组件化开发、自动化数据绑定，并拥抱Web标准。</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>官方的案例：<br><img src="../../../../images/weex_demo.png" alt="Weex Demo"><br>具体可以在官网下载<a href="http://alibaba.github.io/weex/download.html" target="_blank" rel="external">Weex playground App</a></p>

        
      </div>
      <div class="post-footer clearfix">
        <a href="/2016/04/22/阿里Weex跨平台开发工具开源啦/" class="post-more waves-button-light">更多</a>
      </div>
    

  </article>


</li>
  
    <li class="post-list-item">
  <article id="posts-Androidy启动页广告实现" class="article article-type-posts" itemscope itemprop="blogPost">
    
      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/2016/04/21/Androidy启动页广告实现/">Androidy启动页广告实现</a>
    </h3>
  



      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动开发/">移动开发</a></li></ul>
</div>
        <time datetime="2016-04-21T08:50:10.000Z" itemprop="datePublished" class="post-tiem">
  2016-04-21
</time>
      </div>
      <div class="post-content" itemprop="postContent" >
        
          <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>启动页展示广告。主要功能：1.在启动的时候显示广告;2.【跳过】功能，倒计时3秒;3.查看广告详情。<br>如图所示：<br><img src="../../../../images/ad_1.png" alt="启动页广告"></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>layout布局文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span><br><span class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 广告图片 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span><br><span class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/splash_logo"</span></span><br><span class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span><br><span class="line">        <span class="attr">android:visibility</span>=<span class="string">"visible"</span></span><br><span class="line">        <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 跳过 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span><br><span class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/lin_skip"</span></span><br><span class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span><br><span class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span><br><span class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"right"</span></span><br><span class="line">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span><br><span class="line">        <span class="attr">android:layout_marginTop</span>=<span class="string">"40dp"</span></span><br><span class="line">        <span class="attr">android:padding</span>=<span class="string">"4dp"</span></span><br><span class="line">        <span class="attr">android:layout_marginRight</span>=<span class="string">"8dp"</span></span><br><span class="line">        <span class="attr">android:background</span>=<span class="string">"@drawable/splash_skip"</span></span><br><span class="line">        <span class="attr">android:visibility</span>=<span class="string">"gone"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span><br><span class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></span><br><span class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span><br><span class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span><br><span class="line">            <span class="attr">android:paddingLeft</span>=<span class="string">"5dp"</span></span><br><span class="line">            <span class="attr">android:layout_gravity</span>=<span class="string">"right"</span></span><br><span class="line">            <span class="attr">android:text</span>=<span class="string">"3"</span></span><br><span class="line">            <span class="attr">android:textColor</span>=<span class="string">"@color/white"</span></span><br><span class="line">            <span class="attr">android:textSize</span>=<span class="string">"16sp"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span><br><span class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span><br><span class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span><br><span class="line">            <span class="attr">android:layout_gravity</span>=<span class="string">"right"</span></span><br><span class="line">            <span class="attr">android:paddingLeft</span>=<span class="string">"5dp"</span></span><br><span class="line">            <span class="attr">android:paddingRight</span>=<span class="string">"5dp"</span></span><br><span class="line">            <span class="attr">android:text</span>=<span class="string">"跳过"</span></span><br><span class="line">            <span class="attr">android:textColor</span>=<span class="string">"@color/white"</span></span><br><span class="line">            <span class="attr">android:textSize</span>=<span class="string">"16sp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>【跳过】按钮背景：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 填充色 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#CBCBCB"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 圆角 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"18dp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Activity文件:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SplashActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> <span class="keyword">implements</span> <span class="title">ISplashActivity</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bind</span>(R.id.splash_logo)</span><br><span class="line">    ImageView splashLogo;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.logo_layout)</span><br><span class="line">    LinearLayout logoLayout;</span><br><span class="line">    <span class="keyword">private</span> Intent intent;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.textView)</span><br><span class="line">    TextView textView;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.lin_skip)</span><br><span class="line">    LinearLayout linSkip;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ISplashPresenter splashPresenter;</span><br><span class="line">    <span class="keyword">private</span> HttpParams httpParams;</span><br><span class="line">    <span class="keyword">private</span> ADBean adBean;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 设置root界面</span><br><span class="line">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRootView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setRootView();</span><br><span class="line">        setContentView(R.layout.activity_splansh);</span><br><span class="line">        ButterKnife.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.initData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initWidget</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.initWidget();</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logoLayout.setVisibility(View.VISIBLE);</span><br><span class="line">        splashPresenter = <span class="keyword">new</span> SplashPresenter(<span class="keyword">this</span>);</span><br><span class="line">        httpParams = <span class="keyword">new</span> HttpParams();</span><br><span class="line">        splashPresenter.getSplashAD(httpParams);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGetSplashADSuccess</span><span class="params">(ADBean adBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.adBean = adBean;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != adBean &amp;&amp; <span class="keyword">null</span> != adBean.getData() &amp;&amp; !<span class="string">""</span>.equals(adBean.getData().getImagePath()) &amp;&amp; <span class="keyword">null</span> != adBean.getData().getImagePath()) &#123;</span><br><span class="line">            ImageLoader imageLoader = ImageLoader.getInstance();</span><br><span class="line">            imageLoader.displayImage(API.FTP_SERVER + adBean.getData().getImagePath(), splashLogo, TrueLoveApp.options);</span><br><span class="line">            linSkip.setVisibility(View.VISIBLE);</span><br><span class="line">            handler.sendEmptyMessageDelayed(<span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            splashLogo.setImageResource(R.mipmap.ic_splash);</span><br><span class="line">            splashLogo.setClickable(<span class="keyword">false</span>);</span><br><span class="line">            linSkip.setVisibility(View.GONE);</span><br><span class="line">            handler.sendEmptyMessageDelayed(-<span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClick</span>(R.id.splash_logo)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSplashLogoClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        handler.removeMessages(<span class="number">0</span>);</span><br><span class="line">        startActivtiy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClick</span>(R.id.lin_skip)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnSkipClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        handler.removeMessages(<span class="number">0</span>);</span><br><span class="line">        handler.sendEmptyMessageDelayed(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGetSplashADError</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        splashLogo.setImageResource(R.mipmap.ic_splash);</span><br><span class="line">        splashLogo.postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                intent = <span class="keyword">new</span> Intent(SplashActivity.<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, CommonContant.SPLANSH_TIME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        count--;</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">            finish();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(android.os.Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (msg.what == <span class="number">0</span>) &#123;</span><br><span class="line">                textView.setText(getCount()+<span class="string">""</span>);</span><br><span class="line">                handler.sendEmptyMessageDelayed(<span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 跳过</span></span><br><span class="line">            <span class="keyword">if</span> (msg.what == <span class="number">1</span>) &#123;</span><br><span class="line">                handler.removeMessages(<span class="number">1</span>);</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(SplashActivity.<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 无广告</span></span><br><span class="line">            <span class="keyword">if</span> (msg.what == -<span class="number">1</span>) &#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(SplashActivity.<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Activity跳转</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startActivtiy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != adBean) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"1"</span>.equals(adBean.getData().getRelatedContext())) &#123; <span class="comment">//shop</span></span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(mContext, SellerShopDetailActivity.class);</span><br><span class="line">                intent.putExtra(<span class="string">"shopid"</span>, adBean.getData().getRelatedContentId());</span><br><span class="line">                mContext.startActivity(intent);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"2"</span>.equals(adBean.getData().getRelatedContext())) &#123; <span class="comment">//product</span></span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(mContext, SellerProductDetailActivity.class);</span><br><span class="line">                intent.putExtra(<span class="string">"productid"</span>, adBean.getData().getRelatedContentId());</span><br><span class="line">                mContext.startActivity(intent);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                adBean.getData().setAdContent(<span class="keyword">new</span> String(Base64.decode(adBean.getData().getAdContent(), Base64.DEFAULT)));</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(mContext, HomeADDetailActivity.class);</span><br><span class="line">                intent.putExtra(<span class="string">"flag"</span>, <span class="string">"splash"</span>);</span><br><span class="line">                intent.putExtra(<span class="string">"bean"</span>, adBean);</span><br><span class="line">                mContext.startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="运行效果"><a href="#运行效果" class="headerlink" title="运行效果"></a>运行效果</h2><p>启动页：<br><img src="../../../../images/ad.png" alt="广告"><br>广告详情：<br><img src="../../../../images/ad_detail.png" alt="广告详情"></p>

        
      </div>
      <div class="post-footer clearfix">
        <a href="/2016/04/21/Androidy启动页广告实现/" class="post-more waves-button-light">更多</a>
      </div>
    

  </article>


</li>
  
    <li class="post-list-item">
  <article id="posts-Android N将逐步实现对VR支持" class="article article-type-posts" itemscope itemprop="blogPost">
    
      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/2016/04/18/Android N将逐步实现对VR支持/">Android N将逐步实现对VR支持</a>
    </h3>
  



      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/杂谈/">杂谈</a></li></ul>
</div>
        <time datetime="2016-04-18T06:07:10.000Z" itemprop="datePublished" class="post-tiem">
  2016-04-18
</time>
      </div>
      <div class="post-content" itemprop="postContent" >
        
          <p>据国外媒体报道，在Android N的开发者预览版中支持VR功能，同时支持Khronos最新Vulkan API。其他还支持全新的3D渲染API（Vulkan）、Emoji Unicode 9、压感屏及面向平板的分屏多任务模式等。</p>
<p>在Android系统中，可以通过以下路径来访问这个炫酷的功能:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Settings（设置） -&gt; Apps（应用） -&gt; Configure apps（应用配置） -&gt; Special Access（特殊访问） -&gt; VR helper services（虚拟现实辅助服务）</span><br></pre></td></tr></table></figure></p>
<p>然后将显示接入这个API的应用列表，用户可以选择永许或者拒绝。这看起来似乎很快就可以有一个名为VR Listener”或者“VR helper”的应用了。<br><img src="../../../../images/vr_help_services.jpg" alt="VR helper services"></p>
<p>有关VR的细节暂不清楚，但《华尔街日报》在2月份提到过，Google正赶在推出自家基于智能机的头戴式装之前优化Android，让它能够更好地支持VR设备。</p>
<p>有关VR模式的一个猜想是，其会禁用手机的自锁机制，以避免使用一段时间后突然“黑屏”。此外，Google据说还在打造一款无需智能机或PC的独立装置。</p>
<p>根据报道还说有一个新硬件支持标志，名为“Config Sustained Performance Mode Supported”，Ars Technica的Ron Amadeo觉得它可能是一个特殊的功能，允许持续直接使用手机的CPU和GPU，跟Gear VR能够在兼容的三星手机上运行的方式类似。</p>
<p>我们知道谷歌的虚拟现实雄心远远超过了Cardboard，现在通过这个新版本系统的更新可以得道印证。在2016年第三季度Android N发布之前，谷歌至少在计划另外3个开发商预览版，所以我们可能会继续看到虚拟现实功能的增加。</p>

        
      </div>
      <div class="post-footer clearfix">
        <a href="/2016/04/18/Android N将逐步实现对VR支持/" class="post-more waves-button-light">更多</a>
      </div>
    

  </article>


</li>
  
    <li class="post-list-item">
  <article id="posts-Gradle" class="article article-type-posts" itemscope itemprop="blogPost">
    
      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/2016/04/09/Gradle/">Android Studio Gradle</a>
    </h3>
  



      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动开发/">移动开发</a></li></ul>
</div>
        <time datetime="2016-04-09T13:50:04.000Z" itemprop="datePublished" class="post-tiem">
  2016-04-09
</time>
      </div>
      <div class="post-content" itemprop="postContent" >
        
          <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Android Studio 使用 Gradle 构建工具，而 Gradle 继承了强大、灵活的 Ant 和 Maven 丰富的依赖管理，配置管理简单，脚本编写方便灵活，插件模块化。</p>
<p>Android Studio 使用 Gradle 构建工具，Eclipse 的 ADT 插件使用的是 Ant 构建工具。因为两个构建工具的区别，导致习惯了 Eclipse 开发环境的开发者刚开始比较难适应 Android Studio。如果要迁移到 Android Studio，建议最好了解下 Gradle 构建工具。Gradle 构建工具是任务驱动型的构建工具，并且可以通过各种 Plugin 插件扩展功能以适应各种构建任务。对应 Android 项目的 Gradle 插件就是 Android Gradle Plugin。</p>
<h3 id="为什么使用"><a href="#为什么使用" class="headerlink" title="为什么使用"></a>为什么使用</h3><p>Android Studio相比ADT的好处就不啰嗦了，好马配好鞍，Android Studio为什么采用Gradle作为构建工具呢？Gradle是一个优秀的构建系统和构建工具，可以通过插件来创建自定的义构建逻辑。<br>Gradle的优点：</p>
<ul>
<li>采用了Domain Specific Language(DSL 语言) 来描述和控制构建逻辑。</li>
<li>构建文件基于 Groovy，并且允许通过混合声明 DSL 元素和使用代码来控制 DSL 元素以控制自定义的构建逻辑。</li>
<li>支持 Maven 或者 Ivy 的依赖管理。</li>
<li>非常灵活。允许使用最好的实现，但是不会强制实现的方式。</li>
<li>插件可以提供自己的 DSL 和 API 以供构建文件使用。</li>
<li>良好的 API 工具供 IDE 集成。</li>
</ul>
<p>Gradle构建系统的目标：</p>
<ul>
<li>让重用代码和资源变得更加容易</li>
<li>让创建同一个APP的不同版本变得更加容易，无论是多个APP发布版本还是同一个发布不同的版本</li>
<li>让构建过程变得更加容易配置，扩展和定制</li>
<li>整合优秀IDE</li>
</ul>
<h3 id="项目的构建文件"><a href="#项目的构建文件" class="headerlink" title="项目的构建文件"></a>项目的构建文件</h3><p>Gradle在Android Studio的项目中是如何使用的呢？一个Gradle项目的构建过程定义在了build.gradle的文件中，在项目的根目录下，如图：</p>
<p><img src="../../../../img/project.png" alt="android项目"></p>
<p>最简单的Android项目的build.gradle文件包含以下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">'com.android.tools.build:gradle:0.11.1'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: <span class="string">'android'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">19</span></span><br><span class="line">    buildToolsVersion <span class="string">"19.0.0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单分析下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildscrip&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>配置驱动构建过程的代码，在这个部分声明了使用Maven仓库，并且声明了一个maven文件的依赖路径。这个文件就是包含了0.11.1版本android gradle插件的库。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'android'</span></span><br></pre></td></tr></table></figure>
<p>这里添加了android插件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>这里配置android构建过程需要的参数</p>
<p>默认情况下，只需要配置目标编译SDK版本和编译工具版本，即compileSdkVersion和buildToolsVersion属性。 这个complieSdkVersion属性相当于旧构建系统中project.properites文件中的target属性。这个新的属性可以跟旧的target属性一样指定一个int或者String类型的值。</p>
<p>与上面基本的构建文件对应的是一个默认的文件夹结构。Gradle遵循约定优先于配置的概念，我们需要在可能的情况尽可能提供合理的默认配置参数。</p>
<p>基本的项目开始于两个名为“source sets”的组件，即main source code和test code。分别位于：</p>
<ul>
<li>src/main/</li>
<li>src/androidTest/<br>里面每一个文件夹都有与之相应的源组件:</li>
<li>AndroidManifest.xml</li>
<li>res/</li>
<li>assets/</li>
<li>aidl/</li>
<li>rs/</li>
<li>jni/</li>
</ul>
<h3 id="配置结构"><a href="#配置结构" class="headerlink" title="配置结构"></a>配置结构</h3><p>当默认的项目结构不适用的时候，你可能需要去配置它。根据Gradle文档，重新为Android项目sourceSets。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    <span class="built_in">source</span>Sets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            manifest.srcFile <span class="string">'AndroidManifest.xml'</span></span><br><span class="line">            java.srcDirs = [<span class="string">'src'</span>]</span><br><span class="line">            resources.srcDirs = [<span class="string">'src'</span>]</span><br><span class="line">            aidl.srcDirs = [<span class="string">'src'</span>]</span><br><span class="line">            renderscript.srcDirs = [<span class="string">'src'</span>]</span><br><span class="line">            res.srcDirs = [<span class="string">'res'</span>]</span><br><span class="line">            assets.srcDirs = [<span class="string">'assets'</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        androidTest.setRoot(<span class="string">'tests'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它使用了旧项目结构中的main源码，并且将androidTest <em>sourceSet</em>组件重新映射到<em>tests</em>文件夹。</p>
<h3 id="构建任务"><a href="#构建任务" class="headerlink" title="构建任务"></a>构建任务</h3><p>添加一个插件到构建文件中将会自动创建一系列构建任务(build tasks)去执行（注：gradle属于任务驱动型构建工具，它的构建过程是基于Task的）。Java plugin和Android plugin都会创建以下task：</p>
<ul>
<li>assemble<br>  这个task将会组合项目的所有输出。</li>
<li>check<br>  这个task将会执行所有检查。</li>
<li>connectedCheck<br>  这个task将会在一个指定的设备或者模拟器上执行检查，它们可以同时在所有连接的设备上执行。</li>
<li>deviceCheck<br>  通过APIs连接远程设备来执行检查，这是在CL服务器上使用的。</li>
<li>build<br>  这个task将会执行assemble和check两个task的所有工作</li>
<li>clean<br>  这个task将会清空项目的输出。</li>
</ul>
<p>实际上assemble，check，build这三个task不做任何事情。它们只是一个Task标志，用来告诉android plugin添加实际需要执行的task去完成这些工作。</p>
<p>这就允许你去调用相同的task，而不需要考虑当前是什么类型的项目，或者当前项目添加了什么plugin。 例如，添加了findbugs plugin将会创建一个新的task并且让check task依赖于这个新的task。当check task被调用的时候，这个新的task将会先被调用。</p>
<p>在命令行环境中，你可以执行以下命令来获取更多高级别的task：</p>
<pre><code>gradle tasks
</code></pre><p>查看所有task列表和它们之间的依赖关系可以执行以下命令：</p>
<pre><code>gradle tasks --all
</code></pre><p>注意：<br>Gradle会自动监视一个task声明的所有输入和输出。<br>两次执行build task并且期间项目没有任何改动，gradle将会使用UP-TO-DATE通知所有task。这意味着第二次build执行的时候不会请求任何task执行。这允许task之间互相依赖，而不会导致不需要的构建请求被执行。</p>
<p>一个Android项目至少拥有两个输出：debug APK（调试版APK)和release APK（发布版APK）。每一个输出都拥有自己的标识性task以便能够单独构建它们。</p>
<ul>
<li>assemble<ul>
<li>assembleDebug</li>
<li>assembleRelease<br>它们都依赖于其它一些tasks以完成构建一个APK需要多个步骤。其中assemble task依赖于这两个task，所以执行assemble将会同时构建出两个APK。</li>
</ul>
</li>
</ul>
<p>check task也拥有自己的依赖：</p>
<ul>
<li>check<ul>
<li>lint</li>
</ul>
</li>
<li>connectedCheck<ul>
<li>connectedAndroidTest</li>
<li>connectedUiAutomatorTest(目前还没有应用到）</li>
</ul>
</li>
<li>deviceCheck<ul>
<li>这个test依赖于test创建时，其它实现测试扩展点的插件。</li>
</ul>
</li>
</ul>
<p>最后，只要task能够被安装（那些要求签名的task），android plugin就会为所有构建类型（debug，release，test）安装或者卸载。</p>
<h3 id="基本的构建定制"><a href="#基本的构建定制" class="headerlink" title="基本的构建定制"></a>基本的构建定制</h3><p>Android plugin提供了大量DSL用于直接从构建系统定制大部分事情。</p>
<p>Manifest 属性</p>
<p>通过SDL可以配置一下manifest选项：</p>
<ul>
<li>minSdkVersion</li>
<li>targetSdkVersion</li>
<li>versionName</li>
<li>applicationId (有效的包名 – 更多详情请查阅ApplicationId 对比 PackageName)</li>
<li>package Name for the test application</li>
<li>Instrumentation test runner</li>
</ul>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">19</span></span><br><span class="line">    buildToolsVersion <span class="string">"19.0.0"</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        versionCode <span class="number">12</span></span><br><span class="line">        versionName <span class="string">"2.0"</span></span><br><span class="line">        minSdkVersion <span class="number">16</span></span><br><span class="line">        targetSdkVersion <span class="number">16</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在android元素中的defaultConfig元素中定义所有配置。</p>
<h3 id="构建类型"><a href="#构建类型" class="headerlink" title="构建类型"></a>构建类型</h3><p>默认情况下，Android Plugin会自动给项目设置同时构建应用程序的debug和release版本。 两个版本之间的不同主要围绕着能否在一个安全设备上调试，以及APK如何签名。</p>
<p>Debug版本采用使用通用的name/password键值对自动创建的数字证书进行签名，以防止构建过程中出现请求信息。Release版本在构建过程中没有签名，需要稍后再签名。</p>
<p>这些配置通过一个BuildType对象来配置。默认情况下，这两个实例都会被创建，分别是一个debug版本和一个release版本。</p>
<p>Android plugin允许像创建其他构建类型一样定制debug和release实例。这需要在buildTypes的DSL容器中配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        debug &#123;</span><br><span class="line">            applicationIdSuffix <span class="string">".debug"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        jnidebug.initWith(buildTypes.debug)</span><br><span class="line">        jnidebug &#123;</span><br><span class="line">            packageNameSuffix <span class="string">".jnidebug"</span></span><br><span class="line">            jnidebugBuild <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码片段实现了以下功能：</p>
<ul>
<li>配置默认的debug构建类型<ul>
<li>将debug版本的包名设置为.debug以便能够同时在一台设备上安装<em>debug</em>和<em>release</em>版本的apk。</li>
<li>创建了一个名为jnidebug的新构建类型，并且这个构建类型是debug构建类型的一个副本。</li>
<li>继续配置jnidebug构建类型，允许使用JNI组件，并且也添加了不一样的包名后缀。</li>
</ul>
</li>
</ul>
<p>创建一个新的构建类型就是简单的在buildType标签下添加一个新的元素，并且可以使用initWith()或者直接使用闭包来配置它。</p>
<h3 id="签名配置"><a href="#签名配置" class="headerlink" title="签名配置"></a>签名配置</h3><p>对一个应用程序签名需要以下：</p>
<ul>
<li>一个Keystory</li>
<li>一个keystory密码</li>
<li>一个key的别名</li>
<li>一个key的密码</li>
<li>存储类型</li>
</ul>
<p>位置，键名，两个密码，还有存储类型一起形成了签名配置。</p>
<p>默认情况下，debug被配置成使用一个debug keystory。 debug keystory使用了默认的密码和默认key及默认的key密码。 debug keystory的位置在$HOME/.android/debug.keystroe，如果对应位置不存在这个文件将会自动创建一个。</p>
<p>debug Build Type(构建类型) 会自动使用debug SigningConfig (签名配置)。</p>
<p>可以创建其他配置或者自定义内建的默认配置。通过signingConfigs这个DSL容器来配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        debug &#123;</span><br><span class="line">            <span class="function">storeFile <span class="title">file</span><span class="params">(<span class="string">"debug.keystore"</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        myConfig </span>&#123;</span><br><span class="line">            <span class="function">storeFile <span class="title">file</span><span class="params">(<span class="string">"other.keystore"</span>)</span></span><br><span class="line">            storePassword "android"</span><br><span class="line">            keyAlias "androiddebugkey"</span><br><span class="line">            keyPassword "android"</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes </span>&#123;</span><br><span class="line">        foo &#123;</span><br><span class="line">            debuggable <span class="keyword">true</span></span><br><span class="line">            jniDebugBuild <span class="keyword">true</span></span><br><span class="line">            signingConfig signingConfigs.myConfig</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码片段修改debug keystory的路径到项目的根目录下。在这个例子中，这将自动影响其他使用到debug构建类型的构建类型。</p>
<h3 id="运行-Proguard"><a href="#运行-Proguard" class="headerlink" title="运行 Proguard"></a>运行 Proguard</h3><p>从Gradle Plugin for ProGuard version 4.10之后就开始支持ProGuard。ProGuard插件是自动添加进来的。如果<em>Build Type</em>的<em>runProguard</em>属性被设置为true，对应的task将会自动创建。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="function">runProguard <span class="keyword">true</span></span><br><span class="line">            proguardFile <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    productFlavors </span>&#123;</span><br><span class="line">        flavor1 &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        flavor2 &#123;</span><br><span class="line">            proguardFile <span class="string">'some-other-rules.txt'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发布版本将会使用它的Build Type中声明的规则文件，product flavor（定制的产品版本）将会使用对应flavor中声明的规则文件。</p>
<p>这里有两个默认的规则文件：</p>
<ul>
<li>proguard-android.txt</li>
<li>proguard-android-optimize.txt</li>
</ul>
<p>这两个文件都在SDK的路径下。使用<em>getDefaultProguardFile()</em>可以获取这些文件的完整路径。它们除了是否要进行优化之外，其它都是相同的。</p>

        
      </div>
      <div class="post-footer clearfix">
        <a href="/2016/04/09/Gradle/" class="post-more waves-button-light">更多</a>
      </div>
    

  </article>


</li>
  
    <li class="post-list-item">
  <article id="posts-动态权限管理" class="article article-type-posts" itemscope itemprop="blogPost">
    
      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/2016/04/08/动态权限管理/">Android 6.0 动态权限管理</a>
    </h3>
  



      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动开发/">移动开发</a></li></ul>
</div>
        <time datetime="2016-04-08T06:16:09.000Z" itemprop="datePublished" class="post-tiem">
  2016-04-08
</time>
      </div>
      <div class="post-content" itemprop="postContent" >
        
          <p>随着Android6.0的发布，更多的新特性被推出，极大的提升了用户体验，但同时也做了一些改变，对开发人员带来了一定的麻烦。</p>
<p>Android 6.0在我们原有的AndroidManifest.xml声明权限的基础上，又新增了运行时权限动态检测，以下权限都需要在运行时判断：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">身体传感器</span><br><span class="line">日历</span><br><span class="line">摄像头</span><br><span class="line">通讯录</span><br><span class="line">地理位置</span><br><span class="line">麦克风</span><br><span class="line">电话</span><br><span class="line">短信</span><br><span class="line">存储空间</span><br></pre></td></tr></table></figure>
<h3 id="运行时权限处理"><a href="#运行时权限处理" class="headerlink" title="运行时权限处理"></a>运行时权限处理</h3><p>Android6.0系统默认为targetSdkVersion小于23的应用默认授予了所申请的所有权限，所以如果你以前的APP设置的targetSdkVersion低于23，在运行时也不会崩溃，但这也只是一个临时的救急策略，用户还是可以在设置中取消授予的权限。</p>
<p>虽然系统有默认的授权提示框，但我们人需要自己来配置页面。因为系统默认的授权提示框，有【不再提示】的选项，如果被选择，则再也无法触发授权提示了。只有使用我们自定义的授权提示页面，才可以引导用户修改授权。</p>
<h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><p>权限有分为【危险权限】和【一般权限】，危险权限必须要授权才可以使用，一般权限则不需要，如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--危险权限--&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.READ_CALENDAR"</span>/&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.WRITE_CALENDAR"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--一般权限--&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<p>既然要实现自定义授权页面，那我需要写一个权限检查的工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 权限检查工具类</span><br><span class="line"> * </span><br><span class="line"> * Created by tanchaoyin on 16/1/26.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionsCheckerUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PermissionsCheckerUtil</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mContext = context.getApplicationContext();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断权限列表</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkPermissions</span><span class="params">(String... permissions)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String permission : permissions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (checkPermission(permission)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 否缺少权限的判断</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkPermission</span><span class="params">(String permission)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ContextCompat.checkSelfPermission(mContext, permission) ==</span><br><span class="line">                PackageManager.PERMISSION_DENIED;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义授权页面"><a href="#自定义授权页面" class="headerlink" title="自定义授权页面"></a>自定义授权页面</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 权限获取页面</span><br><span class="line"> * </span><br><span class="line"> * Created by tanchaoyin on 16/1/26.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionsActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PERMISSIONS_GRANTED = <span class="number">0</span>; <span class="comment">// 权限授权</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PERMISSIONS_DENIED = <span class="number">1</span>; <span class="comment">// 权限拒绝</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PERMISSION_REQUEST_CODE = <span class="number">0</span>; <span class="comment">// 系统权限管理页面的参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXTRA_PERMISSIONS = <span class="string">"com.tanchaoyin.permission.extra_permission"</span>; <span class="comment">// 权限参数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PACKAGE_URL_SCHEME = <span class="string">"package:"</span>; <span class="comment">// 方案</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PermissionsChecker mChecker; <span class="comment">// 权限检测器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isRequireCheckFlag; <span class="comment">// 是否需要系统权限检测</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startActivityForResult</span><span class="params">(Activity activity, <span class="keyword">int</span> requestCode, String... permissions)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(activity, PermissionsActivity.class);</span><br><span class="line">        intent.putExtra(EXTRA_PERMISSIONS, permissions);</span><br><span class="line">        ActivityCompat.startActivityForResult(activity, intent, requestCode, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="keyword">if</span> (getIntent() == <span class="keyword">null</span> || !getIntent().hasExtra(EXTRA_PERMISSIONS)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"呵呵，出错了哦。需要静态的startActivityForResult方法才可以启动哦！！！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        setContentView(R.layout.activity_permissions);</span><br><span class="line"></span><br><span class="line">        mChecker = <span class="keyword">new</span> PermissionsChecker(<span class="keyword">this</span>);</span><br><span class="line">        isRequireCheckFlag = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        <span class="keyword">if</span> (isRequireCheckFlag) &#123;</span><br><span class="line">            String[] permissions = getPermissions();</span><br><span class="line">            <span class="keyword">if</span> (mChecker.lacksPermissions(permissions)) &#123;</span><br><span class="line">                requestPermissions(permissions); <span class="comment">// 请求权限</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                allPermissionsGranted(); <span class="comment">// 全部权限都已获取</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            isRequireCheckFlag = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回传递的权限参数</span></span><br><span class="line">    <span class="keyword">private</span> String[] getPermissions() &#123;</span><br><span class="line">        <span class="keyword">return</span> getIntent().getStringArrayExtra(EXTRA_PERMISSIONS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求权限兼容低版本</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">requestPermissions</span><span class="params">(String... permissions)</span> </span>&#123;</span><br><span class="line">        ActivityCompat.requestPermissions(<span class="keyword">this</span>, permissions, PERMISSION_REQUEST_CODE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全部权限均已获取</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">allPermissionsGranted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setResult(PERMISSIONS_GRANTED);</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 用户权限处理</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> requestCode</span><br><span class="line">     * <span class="doctag">@param</span> permissions</span><br><span class="line">     * <span class="doctag">@param</span> grantResults</span><br><span class="line">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (requestCode == PERMISSION_REQUEST_CODE &amp;&amp; checkAllPermissionsGranted(grantResults)) &#123;</span><br><span class="line">            isRequireCheckFlag = <span class="keyword">true</span>;</span><br><span class="line">            allPermissionsGranted();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            isRequireCheckFlag = <span class="keyword">false</span>;</span><br><span class="line">            showMissingPermissionDialog();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是否有全部的权限</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkAllPermissionsGranted</span><span class="params">(@NonNull <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> grantResult : grantResults) &#123;</span><br><span class="line">            <span class="keyword">if</span> (grantResult == PackageManager.PERMISSION_DENIED) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示缺失权限提示</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showMissingPermissionDialog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.Builder(PermissionsActivity.<span class="keyword">this</span>);</span><br><span class="line">        builder.setTitle(R.string.help);</span><br><span class="line">        builder.setMessage(R.string.string_help_text);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拒绝, 退出应用</span></span><br><span class="line">        builder.setNegativeButton(R.string.quit, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                setResult(PERMISSIONS_DENIED);</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        builder.setPositiveButton(R.string.settings, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                startAppSettings();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        builder.show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启动应用的设置</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startAppSettings</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);</span><br><span class="line">        intent.setData(Uri.parse(PACKAGE_URL_SCHEME + getPackageName()));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="权限使用"><a href="#权限使用" class="headerlink" title="权限使用"></a>权限使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_CODE = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 需要使用的所有权限</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String[] PERMISSIONS = <span class="keyword">new</span> String[]&#123;</span><br><span class="line">            Manifest.permission.READ_CALENDAR,</span><br><span class="line">            Manifest.permission.WRITE_CALENDAR,</span><br><span class="line">            Manifest.permission.INTERNET</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bind</span>(R.id.toolbar) Toolbar toolbar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PermissionsCheckerUtil permissionsCheckerUtil; <span class="comment">// 权限检测器</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        ButterKnife.bind(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        setSupportActionBar(mTToolbar);</span><br><span class="line"></span><br><span class="line">        permissionsCheckerUtil = <span class="keyword">new</span> PermissionsCheckerUtil(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 没有权限, 则进入权限配置页面</span></span><br><span class="line">        <span class="keyword">if</span> (permissionsCheckerUtil.lacksPermissions(PERMISSIONS)) &#123;</span><br><span class="line">            <span class="comment">// 权限配置页面</span></span><br><span class="line">            startPermissionsActivity();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startPermissionsActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PermissionsActivity.startActivityForResult(<span class="keyword">this</span>, REQUEST_CODE, PERMISSIONS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">        <span class="comment">// 拒绝授权, 关闭页面, 没有主要权限的情况下无法运行</span></span><br><span class="line">        <span class="keyword">if</span> (requestCode == REQUEST_CODE &amp;&amp; resultCode == PermissionsActivity.PERMISSIONS_DENIED) &#123;</span><br><span class="line">            finish();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一下这些权限，可以直接声明使用:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">android.permission.ACCESS_LOCATION_EXTRA_COMMANDS</span><br><span class="line">android.permission.ACCESS_NETWORK_STATE</span><br><span class="line">android.permission.ACCESS_NOTIFICATION_POLICY</span><br><span class="line">android.permission.ACCESS_WIFI_STATE</span><br><span class="line">android.permission.ACCESS_WIMAX_STATE</span><br><span class="line">android.permission.BLUETOOTH</span><br><span class="line">android.permission.BLUETOOTH_ADMIN</span><br><span class="line">android.permission.BROADCAST_STICKY</span><br><span class="line">android.permission.CHANGE_NETWORK_STATE</span><br><span class="line">android.permission.CHANGE_WIFI_MULTICAST_STATE</span><br><span class="line">android.permission.CHANGE_WIFI_STATE</span><br><span class="line">android.permission.CHANGE_WIMAX_STATE</span><br><span class="line">android.permission.DISABLE_KEYGUARD</span><br><span class="line">android.permission.EXPAND_STATUS_BAR</span><br><span class="line">android.permission.FLASHLIGHT</span><br><span class="line">android.permission.GET_ACCOUNTS</span><br><span class="line">android.permission.GET_PACKAGE_SIZE</span><br><span class="line">android.permission.INTERNET</span><br><span class="line">android.permission.KILL_BACKGROUND_PROCESSES</span><br><span class="line">android.permission.MODIFY_AUDIO_SETTINGS</span><br><span class="line">android.permission.NFC</span><br><span class="line">android.permission.READ_SYNC_SETTINGS</span><br><span class="line">android.permission.READ_SYNC_STATS</span><br><span class="line">android.permission.RECEIVE_BOOT_COMPLETED</span><br><span class="line">android.permission.REORDER_TASKS</span><br><span class="line">android.permission.REQUEST_INSTALL_PACKAGES</span><br><span class="line">android.permission.SET_TIME_ZONE</span><br><span class="line">android.permission.SET_WALLPAPER</span><br><span class="line">android.permission.SET_WALLPAPER_HINTS</span><br><span class="line">android.permission.SUBSCRIBED_FEEDS_READ</span><br><span class="line">android.permission.TRANSMIT_IR</span><br><span class="line">android.permission.USE_FINGERPRINT</span><br><span class="line">android.permission.VIBRATE</span><br><span class="line">android.permission.WAKE_LOCK</span><br><span class="line">android.permission.WRITE_SYNC_SETTINGS</span><br><span class="line">com.android.alarm.permission.SET_ALARM</span><br><span class="line">com.android.launcher.permission.INSTALL_SHORTCUT</span><br><span class="line">com.android.launcher.permission.UNINSTALL_SHORTCUT</span><br></pre></td></tr></table></figure>
        
      </div>
      <div class="post-footer clearfix">
        <a href="/2016/04/08/动态权限管理/" class="post-more waves-button-light">更多</a>
      </div>
    

  </article>


</li>
  
    <li class="post-list-item">
  <article id="post-IPC机制" class="article article-type-post" itemscope itemprop="blogPost">
    
      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/2016/04/07/IPC机制/">Android IPC机制</a>
    </h3>
  



      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动开发/">移动开发</a></li></ul>
</div>
        <time datetime="2016-04-07T02:38:40.000Z" itemprop="datePublished" class="post-tiem">
  2016-04-07
</time>
      </div>
      <div class="post-content" itemprop="postContent" >
        
          <p><strong>Android IPC机制</strong></p>
<p>在任何一个操作系统中都需要IPC机制的存在，例如：Linux中通过共享内存、命名通道等来实现进程间的通信。然而在Android系统中是什么来实现呢？答案是Binder。当然，不仅使用了Binder机制来实现了IPC,还使用了Socket实现不同终端之间的通信。</p>
<h3 id="IPC介绍"><a href="#IPC介绍" class="headerlink" title="IPC介绍"></a>IPC介绍</h3><p>1、Serializable接口是Java中为对象提供标准的序列化和反序列化操作的接口，而Parcelable接口是Android提供的序列化方式的接口。</p>
<p>2、serialVersionUId是一串long型数字，主要是用来辅助序列化和反序列化的，原则上序列化后的数据中的serialVersionUId只有和当前类的serialVersionUId相同才能够正常地被反序列化。serialVersionUId的详细工作机制：序列化的时候系统会把当前类的serialVersionUId写入序列化的文件中，当反序列化的时候系统会去检测文件中的serialVersionUId，看它是否和当前类的serialVersionUId一致，如果一致就说明序列化的类的版本和当前类的版本是相同的，这个时候可以成功反序列化；否则说明版本不一致无法正常反序列化。一般来说，我们应该手动指定serialVersionUId的值：<br>    1.静态成员变量属于类不属于对象，所以不参与序列化过程；<br>    2.声明为transient的成员变量不参与序列化过程。<br>    3.Parcelable接口内部包装了可序列化的数据，可以在Binder中自由传输，Parcelable主要用在内存序列化上，可以直接序列化的有Intent、Bundle、Bitmap以及List和Map等等</p>
<h3 id="实现IPC的方式"><a href="#实现IPC的方式" class="headerlink" title="实现IPC的方式"></a>实现IPC的方式</h3><p>1、 Bundle：Bundle实现了Parcelable接口，Activity、Service和Receiver都支持在Intent中传递Bundle数据。</p>
<p>2、 Messenger：Messenger是一种轻量级的IPC方案，其底层是用AIDL实现的。Messenger是以串行的方式处理请求的，服务端只能一个个处理，不能并发执行。</p>
<p>3、 AIDL：第一步创建一个Service和一个AIDL接口，第二步创建一个类继承自AIDL接口中的Stub类并实现Stub类中的抽象方法，然后在Service的onBind方法中返回这个类的对象，再在客户端绑定服务端Service，建立连接后就可以访问远程服务端的方法。</p>
<pre><code>1.AIDL支持的数据类型：基本数据类型、String和CharSequence、ArrayList、HashMap、Parcelable以及AIDL；
2.某些类即使和AIDL文件在同一个包中也要显式import进来；
3.AIDL中除了基本数据类，其他类型的参数都要标上方向：in、out或者inout；
4.AIDL接口中支持方法，不支持声明静态变量；
5.为了方便AIDL的开发，建议把所有和AIDL相关的类和文件全部放入同一个包中，这样做的好处是，当客户端是另一个应用的时候，可以直接把整个包复制到客户端工程中。
6.RemoteCallbackList是系统提供来删除跨进程Listener的接口。是一个泛型，可以管理任何的ALDL接口。
</code></pre><p> 4、ContentProvider：</p>
<pre><code>1.ContentProvider主要以表格的形式来组织数据，并且可以包含多个表；
2.ContentProvider还支持文件数据，比如图片、视频等，系统提供的MediaStore就是文件类型的ContentProvider；
3.ContentProvider对底层的数据存储方式没有任何要求，可以是SQLite、文件，甚至是内存中的一个对象都行；
4.要观察ContentProvider中的数据变化情况，可以通过ContentResolver的registerContentObserver方法来注册观察者；
</code></pre><p> 5、Socket：Socket是网络通信中“套接字”的概念，分为流式套接字和用户数据包套接字两种，分别对应网络的传输控制层的TCP和UDP协议。 </p>
<p> 6、文件共享：这种方式简单，适合在对数据同步要求不高的进程之间进行通信，并且要妥善处理并发读写的问题。</p>
<h3 id="Binder连接池"><a href="#Binder连接池" class="headerlink" title="Binder连接池"></a>Binder连接池</h3><p>如果项目规模较大，创建过多的Service是不合理的，因为service是系统资源，过多的service会使得应用看起来很重，所以最好的做法是将所有的AIDL放在同一个Service中去管理。其工作机制是：每一个业务模块创建自己的AIDL接口并实现此接口，此时不同业务模块之间不能有耦合，所有实现细节我们要单独开来，然后向服务端提供自己的唯一标识和其对应的Binder对象；对于服务端来说，只需要一个Service，服务端提供一个queryBinder接口，这个接口能够根据业务模块的特征来返回相应的Binder对象给它们，不同的业务模块拿到所需的Binder对象后就可以进行远程方法调用了。<br>Binder连接池的主要作用就是将每个业务模块的Binder请求统一转发到远程Service去执行，从而避免了重复创建Service的过程。</p>

        
      </div>
      <div class="post-footer clearfix">
        <a href="/2016/04/07/IPC机制/" class="post-more waves-button-light">更多</a>
      </div>
    

  </article>


</li>
  
  </ul>
  



    </div>
  </main>
<div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-circle-light"><span class="icon icon-lg icon-chevron-up"></span></a>

<div class="global-share" id="global-share" data-title="JoyTan" data-pic="/img/logo.jpg" data-summary="null" data-url="http://joytan1209.github.io/index.html">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>


<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script src="/js/main.js"></script>




<script type="text/javascript">
var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_1258791101' style='display:none' %3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1258791101%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));
</script>






</body>
</html>
